#!/bin/sh

# Download music from youtube playlists
# Requires youtube-dl and aria2
# Requires ".cache/youtube-dl/downloadedmusic" file for storing downloaded music IDs
# and ".config/youtube-dl/musicsources" to store the playlists

# Prevent execution if there is no musicsources
[ ! -f ~/.config/youtube-dl/musicsources ] && (
  echo 'No "musicsources" file detected in ~/.config/youtube-dl'
  exit
)

# Create cache file if does not exist
[ ! -f ~/.cache/youtube-dl/downloadedmusic ] && mkdir -p ~/.cache/youtube-dl &&
  touch ~/.cache/youtube-dl/downloadedmusic

youtube-dl --add-metadata --no-mtime --no-call-home \
  --buffer-size 16K --external-downloader aria2c \
  --external-downloader-args "-k 1M -x 8 -s 8" --extract-audio \
  --audio-format "m4a" --embed-thumbnail --playlist-end 10 --audio-quality 0 \
  --output '~/storage/downloads/DownloadedMusic/%(title)s.%(ext)s' \
  --download-archive ~/.cache/youtube-dl/downloadedmusic \
  --batch-file ~/.local/share/youtube-dl/musicsources
